---
title: "Ran_Ji_Project2"
author: "Ran Ji"
date: "2025-11-16"
output: word_document
---
1.Setting
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,      
  message = FALSE,   
  warning = FALSE    
)
# load required libraries
library(readr)     
library(dplyr)    
library(lubridate) 
library(ggplot2) 
library(tidyr)
```
2.Load data
```{r}
aq18_raw <- read_csv("data/AQ_2018.csv")  
aq19_raw <- read_csv("data/AQ_2019.csv")  
aq20_raw <- read_csv("data/AQ_2020.csv")  

head(aq18_raw)

str(aq18_raw)
```
3.Function
```{r}
clean_aq <- function(df) {
  
# 1. Rename pollutant concentration columns 
df <- df %>%
rename(
date = Date,
co = `Daily Max 8-hour CO Concentration`,
pm25 = `Daily Mean PM2.5 Concentration`,
o3= `Daily Max 8-hour Ozone Concentration`
)
  
# 2. Convert date column to proper Date format
df <- df %>%
mutate(date = mdy(date))  # Convert month-day-year string to Date object
  
# 3. Compute daily averages when multiple measurements exist
df <- df %>%
group_by(date) %>%
summarise(
co = mean(co, na.rm = TRUE),
pm25 = mean(pm25, na.rm = TRUE),
o3 = mean(o3, na.rm = TRUE),
.groups = "drop"
)
  
# 4. Remove any duplicated rows
df <- df %>% distinct()   # Keep only unique rows
  
# 5. Replace negative concentrations with zero
for (v in c("co", "pm25", "o3")) {  # Loop through pollutant variables
df[[v]][df[[v]] < 0] <- 0  # Set any negative value to 0
}
  
return(df)    # Return cleaned dataset
}
```
The cleaning function performs several preprocessing steps to prepare the air quality data for analysis.
First, it renames the pollutant variables using short and informative names.
Next, the function converts the Date column into proper Date format and averages measurements when multiple readings exist on the same day.
It also removes duplicate rows and corrects measurement errors by replacing any negative pollutant values with zero.
This standardized cleaning ensures that all three datasets (2018–2020) share a consistent structure and are ready for further analysis and visualization.

4.Clean data
```{r}
aq18_clean <- clean_aq(aq18_raw)
aq19_clean <- clean_aq(aq19_raw)
aq20_clean <- clean_aq(aq20_raw)
head(aq18_clean)
summary(aq18_clean)
```
5.Plot
```{r}
#1. combine data
aq_all <- bind_rows(
mutate(aq18_clean, year = 2018),
mutate(aq19_clean, year = 2019),
mutate(aq20_clean, year = 2020)
)
# Extract month from the date variable
aq_all <- aq_all %>%
  mutate(month = month(date))
#2. Calculation
co_o3_monthly <- aq_all %>%
select(month, co, o3) %>%
# Convert CO and O3 into long format for easier plotting
pivot_longer(cols = c(co, o3), names_to = "pollutant", values_to = "value") %>%
# Compute mean, SD, SE, and 95% CI for each month × pollutant
group_by(month, pollutant) %>%
summarise(
mean = mean(value, na.rm = TRUE),
sd = sd(value, na.rm = TRUE),
n = sum(!is.na(value)),
se = sd / sqrt(n),
lower = mean - 1.96 * se,  # 95% CI lower bound
upper = mean + 1.96 * se,  
.groups = "drop"
  )
#3. Plot1
ggplot(co_o3_monthly, aes(x = month, y = mean, color = pollutant, fill = pollutant)) +
geom_line(size = 1) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
scale_x_continuous(breaks = 1:12) +
labs(
title = "Monthly Average CO and O3 Levels (2018–2020 Combined)",
x = "Month",
y = "Concentration"
) +
theme_minimal(base_size = 14)
```

Monthly average CO levels show a clear seasonal pattern, decreasing in the summer and rising sharply in late fall and winter.
Ozone concentrations remain low and relatively stable throughout the year.
The 95% confidence intervals for CO are wider due to greater variability, while O3 variability is minimal.

```{r}
#4.Plot2
pm25_monthly <- aq_all %>%  # start from the combined dataset
group_by(year, month) %>%  #group by year and month
summarise(
pm25_mean = mean(pm25, na.rm = TRUE),  # compute monthly mean PM2.5
  )
pm25_monthly$year <- as.factor(pm25_monthly$year)  # Convert year to a factor to plot separate lines 

ggplot(pm25_monthly, aes(x = month, y = pm25_mean, color = year, group = year)) +
geom_line(size = 1) +
geom_point(size = 2) +
labs(
title = "Monthly Average PM2.5 Levels by Year",
x = "Month",
y = "PM2.5 Concentration",
color = "Year"
) +
scale_x_continuous(breaks = 1:12) +
theme_minimal(base_size = 14)
```

PM2.5 levels show noticeable seasonal variation across all three years, with higher concentrations in winter and early spring.
Although the overall patterns are similar across years, 2018 appears to have slightly higher PM2.5 values during winter months.

Github link: https://github.com/Ran0810/Ran_Ji_Project2









